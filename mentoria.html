<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MENTORIA ELITE PMDF - V13 FULL PAGE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #020617; --gold: #fbbf24; --card: #1e293b;
            --const: #ef4444; --adm: #f97316; --penal: #3b82f6; --proc: #06b6d4;
            --cpm: #8b5cf6; --cppm: #ec4899; --leg: #10b981; --lo: #facc15;
            --peca: #a855f7; --nc: #f472b6; --bg-paper: #cbd5e1;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: var(--primary); color: white; margin: 0; overflow: hidden; height: 100vh; }

        /* HEADER PRINCIPAL */
        header {
            background: var(--card); padding: 10px 20px; border-bottom: 3px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }

        /* LAYOUT PRINCIPAL */
        main { display: flex; height: calc(100vh - 63px); }

        .sidebar { 
            width: 70px; background: #1e293b; display: flex; flex-direction: column; 
            align-items: center; gap: 15px; padding: 20px 0; border-right: 1px solid rgba(255,255,255,0.1); 
        }
        .btn-side { 
            width: 50px; height: 50px; border: none; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; color: white; 
            cursor: pointer; transition: 0.3s; background: rgba(255,255,255,0.05);
        }
        .btn-side i { font-size: 1.2rem; color: var(--gold); }

        .editor-container { flex: 1; background: var(--bg-paper); overflow-y: auto; padding: 20px; display: flex; justify-content: center; }
        .paper { 
            width: 100%; max-width: 850px; background: white; min-height: 1200px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); padding: 60px; color: #000;
        }
        #folha-total { outline: none; line-height: 1.8; font-size: 16px; }

        /* PÁGINA SEPARADA (HUB DE INTELIGÊNCIAS) */
        #hub-inteligencia {
            position: fixed; inset: 0; background: var(--primary); z-index: 9999;
            display: none; flex-direction: column; animation: fadeIn 0.2s ease-in-out;
        }
        #hub-inteligencia.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .header-hub {
            background: var(--card); padding: 15px 20px; border-bottom: 3px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center;
        }
        .btn-voltar {
            background: white; color: black; border: none; padding: 10px 20px;
            border-radius: 8px; font-weight: 900; cursor: pointer; display: flex; align-items: center; gap: 8px;
        }

        .conteudo-hub { flex: 1; overflow-y: auto; padding: 20px; max-width: 900px; margin: 0 auto; width: 100%; }

        /* COMPONENTES DE INPUT */
        .panel-input { background: #0f172a; border-radius: 15px; padding: 20px; margin-bottom: 25px; border: 1px dashed #334155; }
        input, textarea { width: 100%; padding: 12px; margin: 5px 0; background: #1e293b; border: 1px solid #475569; color: white; border-radius: 8px; }

        /* POST-ITS */
        .post-it { padding: 20px; border-radius: 18px; margin-bottom: 20px; color: #020617; position: relative; }
        .post-it strong { display: block; font-size: 1.1rem; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 8px; margin-bottom: 10px; }
        .macete-box { background: rgba(0,0,0,0.1); padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.85rem; font-weight: 800; }

        /* NAV TABS EDITAL */
        .nav-tabs {
            background: var(--card); display: flex; overflow-x: auto; padding: 15px; gap: 10px; border-top: 2px solid var(--gold);
        }
        .tab {
            min-width: 100px; padding: 12px; background: #0f172a; border-radius: 10px;
            color: #94a3b8; text-align: center; font-size: 10px; font-weight: 800; cursor: pointer; flex-shrink: 0;
        }
        .tab.active { background: var(--gold); color: black; }
    </style>
</head>
<body>

<header>
    <div class="logo" style="font-weight:900;">MENTORIA <span style="color:var(--gold)">V13 PMDF</span></div>
    <div style="font-size: 11px; color: var(--gold); font-weight: 800;">ALUNO-OFICIAL CFO</div>
</header>

<main>
    <aside class="sidebar">
        <button class="btn-side" style="background:var(--nc);" onclick="abrirHub('nc')" title="Não Confunda"><i class="fas fa-brain"></i></button>
        <button class="btn-side" onclick="abrirHub('peca')" title="Estrutura da Peça"><i class="fas fa-scroll"></i></button>
        <button class="btn-side" style="background:#059669;" onclick="salvarPeca()"><i class="fas fa-save"></i></button>
    </aside>

    <section class="editor-container">
        <div class="paper">
            <div id="folha-total" contenteditable="true">
                <b>AO JUÍZO DA VARA DE AUDITORIA MILITAR DO DF</b><br><br>
                Inquérito Policial Militar nº...
            </div>
        </div>
    </section>
</main>

<div id="hub-inteligencia">
    <div class="header-hub">
        <button class="btn-voltar" onclick="fecharHub()">
            <i class="fas fa-arrow-left"></i> VOLTAR AO ESTUDO
        </button>
        <span id="titulo-hub" style="font-weight: 900; color: var(--gold); text-transform: uppercase;">INTELIGÊNCIA</span>
    </div>

    <div class="conteudo-hub">
        <div class="panel-input">
            <input id="inp-t" placeholder="Título do Assunto/Artigo">
            <textarea id="inp-c" rows="3" placeholder="Conteúdo técnico para a peça..."></textarea>
            <input id="inp-r" placeholder="Macete/Mnemônico">
            <button onclick="salvarHub()" style="width:100%; padding:15px; background:var(--gold); border:none; border-radius:10px; font-weight:900; cursor:pointer;">GRAVAR NA MEMÓRIA</button>
        </div>
        <div id="feed-hub"></div>
    </div>

    <nav class="nav-tabs">
        <div class="tab active" onclick="showTab('nc')">NÃO CONFUNDA</div>
        <div class="tab" onclick="showTab('peca')">QUAL A PEÇA?</div>
        <div class="tab" onclick="showTab('cpm')">PENAL MILITAR</div>
        <div class="tab" onclick="showTab('cppm')">PROC. PENAL MIL.</div>
        <div class="tab" onclick="showTab('const')">CONSTITUCIONAL</div>
        <div class="tab" onclick="showTab('adm')">ADMINISTRATIVO</div>
        <div class="tab" onclick="showTab('leg')">LEGISLAÇÃO PM</div>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue, push, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        authDomain: "masteroab-db5e1.firebaseapp.com",
        projectId: "masteroab-db5e1",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(config);
    const db = getDatabase(app);

    let currentTab = 'nc';
    let cache = {};

    const temasMap = {
        nc: { t: 'Não Confunda', c: 'var(--nc)' },
        peca: { t: 'Estrutura da Peça', c: 'var(--peca)' },
        cpm: { t: 'Penal Militar', c: 'var(--cpm)' },
        cppm: { t: 'Processo Penal Militar', c: 'var(--cppm)' },
        const: { t: 'Constitucional', c: 'var(--const)' },
        adm: { t: 'Administrativo', c: 'var(--adm)' },
        leg: { t: 'Legislação PMDF', c: 'var(--leg)' }
    };

    window.abrirHub = (tab) => {
        if(tab) showTab(tab);
        document.getElementById('hub-inteligencia').classList.add('active');
    };

    window.fecharHub = () => {
        document.getElementById('hub-inteligencia').classList.remove('active');
    };

    window.showTab = (tab) => {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        const activeTab = document.querySelector(`.tab[onclick*='${tab}']`);
        if(activeTab) activeTab.classList.add('active');
        
        document.getElementById('titulo-hub').innerText = temasMap[tab].t;
        render();
    };

    window.salvarHub = () => {
        const t = document.getElementById('inp-t').value;
        const c = document.getElementById('inp-c').value;
        const r = document.getElementById('inp-r').value;
        if(!t || !c) return alert("Preencha título e conteúdo!");

        push(ref(db, 'v13_master'), {
            t, c, r: r || "", cat: currentTab, ts: serverTimestamp()
        });
        
        document.getElementById('inp-t').value = "";
        document.getElementById('inp-c').value = "";
        document.getElementById('inp-r').value = "";
    };

    onValue(ref(db, 'v13_master'), (snap) => {
        cache = snap.val() || {};
        render();
    });

    function render() {
        const feed = document.getElementById('feed-hub');
        feed.innerHTML = "";
        Object.keys(cache).reverse().forEach(id => {
            const it = cache[id];
            if(it.cat === currentTab) {
                feed.innerHTML += `
                    <div class="post-it" style="background:${temasMap[it.cat].c}">
                        <div style="display:flex; justify-content:space-between">
                            <strong>${it.t}</strong>
                            <i class="fas fa-trash" onclick="apagar('${id}')" style="cursor:pointer; opacity:0.5"></i>
                        </div>
                        <p>${it.c}</p>
                        ${it.r ? `<div class="macete-box">⚡ MACETE: ${it.r}</div>` : ""}
                        <button onclick="injetar('${id}')" style="margin-top:10px; width:100%; border:none; padding:8px; border-radius:5px; background:rgba(0,0,0,0.1); font-weight:bold; cursor:pointer;">INJETAR NA PEÇA</button>
                    </div>`;
            }
        });
    }

    window.injetar = (id) => {
        const it = cache[id];
        document.getElementById('folha-total').innerHTML += `<br><br>${it.c}`;
        fecharHub();
    };

    window.apagar = (id) => { if(confirm("Apagar?")) remove(ref(db, `v13_master/${id}`)); };

    window.salvarPeca = () => {
        alert("Peça salva em PDF no histórico da Mentoria.");
    };
</script>
</body>
</html>
