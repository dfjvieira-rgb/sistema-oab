<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MENTORIA ELITE PMDF - V13 ROBUST</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #020617; --gold: #fbbf24; --card: #1e293b;
            --pmdf-blue: #1e3a8a; --bg-paper: #cbd5e1;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: var(--primary); color: white; margin: 0; overflow: hidden; height: 100vh; }

        /* HEADER PRINCIPAL */
        header {
            background: var(--card); padding: 10px 20px; border-bottom: 3px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center; z-index: 1000;
        }

        /* LAYOUT */
        main { display: flex; height: calc(100vh - 63px); }

        /* SIDEBAR */
        .sidebar { 
            width: 70px; background: #1e293b; display: flex; flex-direction: column; 
            align-items: center; gap: 15px; padding: 20px 0; border-right: 1px solid rgba(255,255,255,0.1); 
        }
        .btn-side { 
            width: 50px; height: 50px; border: none; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; color: white; 
            cursor: pointer; transition: 0.3s; background: rgba(255,255,255,0.05);
        }
        .btn-side i { font-size: 1.2rem; color: var(--gold); }

        /* EDITOR */
        .editor-container { flex: 1; background: var(--bg-paper); overflow-y: auto; padding: 20px; display: flex; justify-content: center; }
        .paper { 
            width: 100%; max-width: 850px; background: white; min-height: 1200px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); padding: 60px; color: #000;
        }
        #folha-total { outline: none; line-height: 1.8; font-size: 16px; }

        /* PÁGINA SEPARADA (HUB DE INTELIGÊNCIA) */
        #pagina-separada {
            position: fixed; inset: 0; background: var(--primary); z-index: 9999;
            display: none; flex-direction: column;
        }
        #pagina-separada.active { display: flex; }

        .header-separado {
            background: var(--card); padding: 15px 20px; border-bottom: 3px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center;
        }
        .btn-voltar {
            background: var(--gold); color: black; border: none; padding: 12px 20px;
            border-radius: 8px; font-weight: 900; cursor: pointer; display: flex; align-items: center; gap: 8px;
        }

        .conteudo-separado { flex: 1; overflow-y: auto; padding: 20px; max-width: 900px; margin: 0 auto; width: 100%; }

        /* COMPONENTES V13 */
        .panel-robust { background: #0f172a; border-radius: 15px; padding: 20px; margin-bottom: 25px; border: 1px solid #334155; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 10px; background: #1e293b; border: 1px solid #475569; color: white; border-radius: 8px; }
        .btn-save-robust { width: 100%; padding: 15px; background: var(--gold); color: black; border: none; border-radius: 10px; font-weight: 900; cursor: pointer; }
        
        .post-it { padding: 20px; border-radius: 18px; margin-bottom: 20px; color: #020617; border-left: 8px solid rgba(0,0,0,0.2); }
        .macete-box { background: rgba(255,255,255,0.3); padding: 10px; border-radius: 10px; font-weight: 800; margin-top: 10px; }

        /* NAV TABS */
        .nav-tabs {
            display: flex; overflow-x: auto; padding: 15px; background: var(--card); gap: 10px; border-top: 2px solid var(--gold);
        }
        .tab {
            min-width: 80px; padding: 10px; background: #0f172a; border-radius: 10px;
            color: #94a3b8; text-align: center; font-size: 11px; font-weight: 800; cursor: pointer;
        }
        .tab.active { background: var(--gold); color: black; }
    </style>
</head>
<body>

<header>
    <div class="logo">MENTORIA <span>V13 PMDF</span></div>
    <div style="font-size: 12px; color: var(--gold);">OFICIAL CFO 2025</div>
</header>

<main>
    <aside class="sidebar">
        <button class="btn-side" style="background:var(--pmdf-blue);" onclick="abrirHub()" title="Inteligência"><i class="fas fa-brain"></i></button>
        <button class="btn-side" onclick="abrirHub('tese')" title="Estruturas"><i class="fas fa-scroll"></i></button>
        <button class="btn-side" style="background:#059669;" onclick="salvarPeca()" title="Salvar"><i class="fas fa-save"></i></button>
    </aside>

    <section class="editor-container">
        <div class="paper">
            <div id="folha-total" contenteditable="true">
                <b>AO JUÍZO DA VARA DE AUDITORIA MILITAR DO DF</b><br><br>
                Ref: Inquérito Policial Militar nº...
            </div>
        </div>
    </section>
</main>

<div id="pagina-separada">
    <div class="header-separado">
        <button class="btn-voltar" onclick="fecharHub()">
            <i class="fas fa-arrow-left"></i> VOLTAR AO ESTUDO
        </button>
        <span style="font-weight: 900; color: var(--gold);">HUB DE INTELIGÊNCIA</span>
    </div>

    <div class="conteudo-separado">
        <div class="panel-robust">
            <h4><i class="fas fa-edit"></i> INJETAR CONHECIMENTO</h4>
            <input id="inp-t" placeholder="Título do Artigo/Tese">
            <textarea id="inp-c" rows="3" placeholder="Conteúdo técnico..."></textarea>
            <textarea id="inp-r" rows="1" style="background:#020617; border-color:var(--gold)" placeholder="Macete/Mnemônico"></textarea>
            <button id="btn-salvar" class="btn-save-robust">GRAVAR NA MEMÓRIA</button>
        </div>

        <div id="feed-pm"></div>
    </div>

    <nav class="nav-tabs">
        <div class="tab active" onclick="showTab('ipm')">IPM</div>
        <div class="tab" onclick="showTab('cpm')">CPM</div>
        <div class="tab" onclick="showTab('cppm')">CPPM</div>
        <div class="tab" onclick="showTab('estatuto')">ESTATUTO</div>
        <div class="tab" onclick="showTab('tese')">TESES/PEÇAS</div>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue, push, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        authDomain: "masteroab-db5e1.firebaseapp.com",
        projectId: "masteroab-db5e1",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(config);
    const db = getDatabase(app);

    let currentTab = 'ipm';
    let cache = {};

    const cores = {
        ipm: '#a855f7', cpm: '#ef4444', cppm: '#3b82f6', estatuto: '#f97316', tese: '#f472b6'
    };

    window.abrirHub = (tab) => {
        if(tab) showTab(tab);
        document.getElementById('pagina-separada').classList.add('active');
    };

    window.fecharHub = () => {
        document.getElementById('pagina-separada').classList.remove('active');
    };

    window.showTab = (tab) => {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        const target = document.querySelector(`.tab[onclick*='${tab}']`);
        if(target) target.classList.add('active');
        render();
    };

    document.getElementById('btn-salvar').onclick = () => {
        const t = document.getElementById('inp-t').value;
        const c = document.getElementById('inp-c').value;
        const r = document.getElementById('inp-r').value;
        if(!t || !c) return alert("Preencha os campos!");

        push(ref(db, 'producao_pmdf/MENTORIA'), {
            t, c, r: r || "", cat: currentTab, ts: serverTimestamp()
        });
        
        document.getElementById('inp-t').value = "";
        document.getElementById('inp-c').value = "";
        document.getElementById('inp-r').value = "";
    };

    onValue(ref(db, 'producao_pmdf/MENTORIA'), (snap) => {
        cache = snap.val() || {};
        render();
    });

    function render() {
        const feed = document.getElementById('feed-pm');
        feed.innerHTML = "";
        Object.keys(cache).reverse().forEach(id => {
            const item = cache[id];
            if(item.cat === currentTab) {
                feed.innerHTML += `
                    <div class="post-it" style="background:${cores[item.cat]}">
                        <div style="display:flex; justify-content:space-between">
                            <strong>${item.t}</strong>
                            <i class="fas fa-trash" onclick="apagar('${id}')" style="cursor:pointer; opacity:0.5"></i>
                        </div>
                        <p style="font-weight:600; margin:10px 0;">${item.c}</p>
                        ${item.r ? `<div class="macete-box">⚡ MACETE: ${item.r}</div>` : ""}
                        <button onclick="injetar('${id}')" style="margin-top:10px; width:100%; border:none; padding:8px; border-radius:5px; background:rgba(0,0,0,0.2); font-weight:bold; cursor:pointer;">INJETAR NA DISCURSIVA</button>
                    </div>`;
            }
        });
    }

    window.injetar = (id) => {
        const item = cache[id];
        document.getElementById('folha-total').innerHTML += `<br><br>${item.c}`;
        fecharHub();
    };

    window.apagar = (id) => { if(confirm("Apagar item?")) remove(ref(db, `producao_pmdf/MENTORIA/${id}`)); };

    window.salvarPeca = () => {
        alert("O disket salvou o PDF no histórico da mentoria.");
    };

    window.abrirPergaminho = () => abrirHub('tese');

</script>
</body>
</html>
