<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA MENTORIA V13 - OPERACIONAL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { 
            --primary: #020617; --gold: #fbbf24; --card: #1e293b; 
            --nc: #f472b6; --law: #10b981; --peca: #a855f7;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--primary); color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* BUSCA E TABS */
        .top-nav { background: var(--card); padding: 15px; border-bottom: 2px solid var(--gold); }
        .search-container { display: flex; gap: 10px; margin-bottom: 10px; }
        input, textarea { flex: 1; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; font-size: 14px; }
        
        .tabs { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; }
        .tab { padding: 10px 15px; background: #0f172a; border-radius: 6px; font-size: 11px; font-weight: 900; cursor: pointer; white-space: nowrap; color: #64748b; border: 1px solid transparent; }
        .tab.active { color: var(--gold); border-color: var(--gold); background: rgba(251, 191, 36, 0.1); }

        /* FORMUL√ÅRIO DE ENTRADA */
        .input-panel { background: #0f172a; padding: 15px; border-bottom: 1px solid #334155; display: none; }
        .input-panel.active { display: block; }
        .btn-save { width: 100%; padding: 12px; background: var(--gold); border: none; border-radius: 6px; font-weight: 900; cursor: pointer; margin-top: 10px; }

        /* FEED DE DADOS */
        .content-scroll { flex: 1; overflow-y: auto; padding: 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; align-content: start; }
        
        .card { 
            background: var(--card); border-radius: 12px; padding: 15px; border-left: 5px solid var(--gold);
            position: relative; animation: slideUp 0.3s ease;
        }
        .card h4 { margin: 0 0 10px 0; font-size: 14px; color: var(--gold); text-transform: uppercase; }
        .card p { font-size: 13px; line-height: 1.5; color: #cbd5e1; margin-bottom: 15px; }
        .card .badge { position: absolute; top: 10px; right: 10px; font-size: 9px; background: rgba(255,255,255,0.1); padding: 3px 6px; border-radius: 4px; }
        
        .card-actions { display: flex; gap: 8px; }
        .btn-card { flex: 1; padding: 10px; border: none; border-radius: 6px; font-weight: 800; font-size: 10px; cursor: pointer; }
        .btn-inj { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981; }
        .btn-del { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* FLOATING ACTION BUTTON */
        .fab { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: black; font-size: 20px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.4); z-index: 200; }
    </style>
</head>
<body>

<div class="top-nav">
    <div class="search-container">
        <input type="text" id="main-search" placeholder="üîç Buscar em toda a intelig√™ncia..." onkeyup="filtrarCards()">
    </div>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('all', this)">TUDO</div>
        <div class="tab" onclick="switchTab('nc', this)">N√ÉO CONFUNDA</div>
        <div class="tab" onclick="switchTab('lei', this)">LEIS/ARTIGOS</div>
        <div class="tab" onclick="switchTab('peca', this)">ESTRUTURAS</div>
        <div class="tab" onclick="switchTab('tese', this)">TESES</div>
    </div>
</div>

<div class="input-panel" id="add-panel">
    <input type="text" id="inp-titulo" placeholder="T√≠tulo da Anota√ß√£o">
    <textarea id="inp-conteudo" rows="3" placeholder="Texto t√©cnico para injetar na pe√ßa..." style="margin-top:8px;"></textarea>
    <div style="display:flex; gap:10px; margin-top:8px;">
        <select id="inp-cat" style="flex:1; background:#0f172a; color:white; border:1px solid #334155; border-radius:6px; padding:10px;">
            <option value="nc">N√£o Confunda</option>
            <option value="lei">Lei/Artigo</option>
            <option value="peca">Estrutura</option>
            <option value="tese">Tese</option>
        </select>
        <button class="btn-save" onclick="salvarDado()" style="flex:1; margin:0;">GRAVAR NO QG</button>
    </div>
</div>

<div class="content-scroll" id="feed-mentoria">
    </div>

<div class="fab" onclick="toggleAddPanel()"><i class="fas fa-plus"></i></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const mentoriaRef = ref(db, 'mentoria_v13_data');

    let currentTab = 'all';

    // INTERFACE
    window.toggleAddPanel = () => {
        const p = document.getElementById('add-panel');
        p.classList.toggle('active');
    };

    window.switchTab = (tab, el) => {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        carregarCards();
    };

    // OPERA√á√ïES DE DADOS
    window.salvarDado = () => {
        const t = document.getElementById('inp-titulo').value;
        const c = document.getElementById('inp-conteudo').value;
        const cat = document.getElementById('inp-cat').value;

        if(!t || !c) return alert("Preencha t√≠tulo e conte√∫do!");

        push(mentoriaRef, { titulo: t, conteudo: c, categoria: cat, data: new Date().toLocaleDateString() });
        
        document.getElementById('inp-titulo').value = "";
        document.getElementById('inp-conteudo').value = "";
        toggleAddPanel();
    };

    window.carregarCards = () => {
        onValue(mentoriaRef, (snap) => {
            const feed = document.getElementById('feed-mentoria');
            feed.innerHTML = "";
            const data = snap.val();
            if(!data) return;

            Object.keys(data).reverse().forEach(id => {
                const item = data[id];
                if(currentTab !== 'all' && item.categoria !== currentTab) return;

                const card = document.createElement('div');
                card.className = 'card';
                card.style.borderLeftColor = getCor(item.categoria);
                card.innerHTML = `
                    <span class="badge">${item.data}</span>
                    <h4>${item.titulo}</h4>
                    <p>${item.conteudo}</p>
                    <div class="card-actions">
                        <button class="btn-card btn-inj" onclick="injetar('${item.conteudo.replace(/'/g, "\\'")}')">INJETAR NA PE√áA</button>
                        <button class="btn-card btn-del" onclick="apagar('${id}')"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                feed.appendChild(card);
            });
        });
    };

    function getCor(cat) {
        const cores = { nc: '#f472b6', lei: '#10b981', peca: '#a855f7', tese: '#fbbf24' };
        return cores[cat] || '#fbbf24';
    }

    window.injetar = (texto) => {
        // Envia o texto para a fun√ß√£o receberTexto do index.html (pai)
        if(window.parent && window.parent.receberTexto) {
            window.parent.receberTexto(texto);
        } else {
            alert("Conte√∫do copiado (Modo Standalone): " + texto);
        }
    };

    window.apagar = (id) => {
        if(confirm("Deseja excluir esta intelig√™ncia do banco de dados?")) {
            remove(ref(db, `mentoria_v13_data/${id}`));
        }
    };

    window.filtrarCards = () => {
        let busca = document.getElementById('main-search').value.toLowerCase();
        document.querySelectorAll('.card').forEach(card => {
            let txt = card.innerText.toLowerCase();
            card.style.display = txt.includes(busca) ? "block" : "none";
        });
    };

    // Inicializa√ß√£o
    carregarCards();
</script>

</body>
</html>
