<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>HUB MENTORIA V13 - BANCO DE DADOS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --primary: #020617; --gold: #fbbf24; --card: #1e293b; --nc: #f472b6; }
        body { font-family: 'Inter', sans-serif; background: var(--primary); color: white; margin: 0; padding: 20px; padding-bottom: 100px; }
        
        .header-hub { position: fixed; top: 0; left: 0; width: 100%; background: var(--card); padding: 15px; border-bottom: 2px solid var(--gold); z-index: 100; display: flex; gap: 10px; }
        input, textarea { flex: 1; padding: 10px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 6px; }
        
        .btn-save { background: var(--gold); color: black; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 900; cursor: pointer; }

        .feed-anotacoes { margin-top: 80px; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        
        .post-it { 
            background: var(--card); border-left: 5px solid var(--gold); padding: 15px; border-radius: 8px; 
            animation: fadeIn 0.3s ease; position: relative;
        }
        .post-it h4 { margin: 0 0 10px 0; color: var(--gold); text-transform: uppercase; font-size: 14px; }
        .post-it p { font-size: 13px; line-height: 1.5; color: #cbd5e1; }
        .post-it .macete { background: rgba(251, 191, 36, 0.1); padding: 8px; border-radius: 4px; font-size: 11px; margin-top: 10px; font-weight: bold; border: 1px dashed var(--gold); }
        
        .actions { display: flex; gap: 10px; margin-top: 15px; }
        .btn-action { flex: 1; padding: 8px; font-size: 10px; font-weight: 800; cursor: pointer; border-radius: 4px; border: none; }
        .btn-inj { background: #059669; color: white; }
        .btn-del { background: #ef4444; color: white; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="header-hub">
    <input type="text" id="titulo" placeholder="Título (Ex: Art. 9 CPM)">
    <textarea id="conteudo" placeholder="Conteúdo técnico..." rows="1"></textarea>
    <input type="text" id="macete" placeholder="Macete/Mnemônico">
    <button class="btn-save" onclick="salvarAnotacao()">GRAVAR</button>
</div>

<div class="feed-anotacoes" id="lista-anotacoes">
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, 'mentoria_v13_anotacoes');

    // SALVAR DENTRO DA MENTORIA
    window.salvarAnotacao = () => {
        const t = document.getElementById('titulo').value;
        const c = document.getElementById('conteudo').value;
        const m = document.getElementById('macete').value;
        if(!t || !c) return alert("Preencha o título e conteúdo!");

        push(dbRef, { titulo: t, conteudo: c, macete: m });
        
        document.getElementById('titulo').value = "";
        document.getElementById('conteudo').value = "";
        document.getElementById('macete').value = "";
    };

    // CARREGAR E EXIBIR DENTRO DA MENTORIA
    onValue(dbRef, (snapshot) => {
        const lista = document.getElementById('lista-anotacoes');
        lista.innerHTML = "";
        const data = snapshot.val();
        if (data) {
            Object.keys(data).reverse().forEach(id => {
                const item = data[id];
                lista.innerHTML += `
                    <div class="post-it">
                        <h4>${item.titulo}</h4>
                        <p>${item.conteudo}</p>
                        ${item.macete ? `<div class="macete">⚡ MACETE: ${item.macete}</div>` : ""}
                        <div class="actions">
                            <button class="btn-action btn-inj" onclick="injetarNaFolha('${item.conteudo.replace(/'/g, "\\'")}')">USAR NA PEÇA</button>
                            <button class="btn-action btn-del" onclick="apagarAnotacao('${id}')">APAGAR</button>
                        </div>
                    </div>
                `;
            });
        }
    });

    window.injetarNaFolha = (texto) => { window.parent.receberTexto(texto); };
    window.apagarAnotacao = (id) => { if(confirm("Apagar permanentemente?")) remove(ref(db, `mentoria_v13_anotacoes/${id}`)); };
</script>
</body>
</html>
