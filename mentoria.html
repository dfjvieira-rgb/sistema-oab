<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CENTRAL DE INTELIGÊNCIA - PMDF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --pmdf-verde: #064e3b; 
            --pmdf-verde-escuro: #022c22;
            --pmdf-ouro: #fbbf24; 
            --pmdf-ouro-dim: #b45309;
            --bg-tatico: #0f172a;
            --card-tatico: #1e293b;
            --texto: #e2e8f0;
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }
        
        body { 
            font-family: 'JetBrains Mono', monospace; 
            background-color: var(--bg-tatico); 
            background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.05) 1px, transparent 0);
            background-size: 40px 40px;
            color: var(--texto); margin: 0; display: flex; flex-direction: column; height: 100vh; 
        }

        /* HEADER TÁTICO */
        .header-operacional {
            background: var(--pmdf-verde-escuro);
            padding: 15px 25px;
            border-bottom: 2px solid var(--pmdf-ouro);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .header-title { font-family: 'Oswald', sans-serif; letter-spacing: 2px; font-size: 1.2rem; color: var(--pmdf-ouro); }
        .header-status { font-size: 10px; color: #10b981; animation: pulse 2s infinite; }

        /* BUSCA E TABS */
        .search-area { background: rgba(2, 44, 34, 0.8); padding: 10px 20px; display: flex; flex-direction: column; gap: 10px; }
        .search-input { 
            background: #020617; border: 1px solid var(--pmdf-ouro); padding: 12px; 
            color: var(--pmdf-ouro); border-radius: 4px; font-family: 'JetBrains Mono';
        }

        .tab-bar { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .tab-btn { 
            background: transparent; border: 1px solid #334155; color: #94a3b8; 
            padding: 8px 15px; cursor: pointer; border-radius: 0px; font-size: 11px; font-weight: bold;
            text-transform: uppercase;
        }
        .tab-btn.active { background: var(--pmdf-ouro); color: black; border-color: var(--pmdf-ouro); }

        /* CONTEÚDO */
        .main-feed { flex: 1; overflow-y: auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }

        .card-missao { 
            background: var(--card-tatico); border: 1px solid #334155; position: relative;
            padding: 20px; border-top: 4px solid var(--pmdf-ouro);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }
        .card-missao::before { content: "DATA_REC: 2026"; position: absolute; top: -12px; left: 10px; font-size: 8px; background: var(--bg-tatico); padding: 2px 5px; color: #64748b; }

        .card-tag { font-size: 9px; color: var(--pmdf-ouro); font-weight: bold; text-transform: uppercase; margin-bottom: 10px; display: block; }
        .card-title { font-family: 'Oswald', sans-serif; margin: 0 0 10px 0; color: white; letter-spacing: 1px; }
        .card-body { font-size: 13px; line-height: 1.6; color: #cbd5e1; margin-bottom: 20px; }

        /* BOTÕES DE AÇÃO */
        .action-row { display: flex; gap: 10px; }
        .btn-tatico { 
            flex: 1; padding: 10px; cursor: pointer; border: 1px solid var(--pmdf-ouro);
            background: transparent; color: var(--pmdf-ouro); font-weight: bold; font-family: 'JetBrains Mono';
            font-size: 10px; text-transform: uppercase;
        }
        .btn-tatico:hover { background: var(--pmdf-ouro); color: black; }
        .btn-danger { border-color: #ef4444; color: #ef4444; }
        .btn-danger:hover { background: #ef4444; color: white; }

        /* PAINEL DE ADIÇÃO (FAB) */
        .add-panel { 
            position: fixed; bottom: 80px; right: 20px; background: var(--card-tatico); 
            border: 2px solid var(--pmdf-ouro); padding: 20px; width: 300px; display: none;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); z-index: 1000;
        }
        .add-panel.active { display: block; }
        .fab { 
            position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; 
            background: var(--pmdf-ouro); color: black; border-radius: 0; display: flex; 
            align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 1001;
            clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%);
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--pmdf-verde); }
    </style>
</head>
<body>

<header class="header-operacional">
    <div class="header-title">INTELIGÊNCIA PMDF <span style="font-weight: 300;">V13</span></div>
    <div class="header-status"><i class="fas fa-satellite-dish"></i> LINK SATÉLITE ATIVO</div>
</header>

<div class="search-area">
    <input type="text" id="tatico-search" class="search-input" placeholder="> FILTRAR INTELIGÊNCIA..." onkeyup="filtrar()">
    <div class="tab-bar">
        <button class="tab-btn active" onclick="switchTab('all', this)">Geral</button>
        <button class="tab-btn" onclick="switchTab('nc', this)">Não Confunda</button>
        <button class="tab-btn" onclick="switchTab('lei', this)">Legislação</button>
        <button class="tab-btn" onclick="switchTab('tese', this)">Teses</button>
    </div>
</div>

<main class="main-feed" id="feed-operacional">
    </main>

<div class="add-panel" id="add-panel">
    <h3 style="color: var(--pmdf-ouro); font-size: 14px; margin-top: 0;">NOVA ENTRADA DE DADOS</h3>
    <input type="text" id="in-titulo" placeholder="TÍTULO" style="width:100%; margin-bottom:10px;" class="search-input">
    <textarea id="in-conteudo" rows="4" placeholder="CONTEÚDO TÉCNICO" style="width:100%; margin-bottom:10px;" class="search-input"></textarea>
    <select id="in-cat" class="search-input" style="width:100%; margin-bottom:10px;">
        <option value="nc">NÃO CONFUNDA</option>
        <option value="lei">LEGISLAÇÃO</option>
        <option value="tese">TESE</option>
    </select>
    <button class="btn-tatico" style="width:100%; background: var(--pmdf-ouro); color: black;" onclick="salvar()">GRAVAR NO BANCO</button>
</div>

<div class="fab" onclick="document.getElementById('add-panel').classList.toggle('active')">
    <i class="fas fa-plus"></i>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const mentoriaRef = ref(db, 'mentoria_v13_data');

    let abaAtual = 'all';

    window.switchTab = (tab, el) => {
        abaAtual = tab;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        carregar();
    };

    window.salvar = () => {
        const t = document.getElementById('in-titulo').value;
        const c = document.getElementById('in-conteudo').value;
        const cat = document.getElementById('in-cat').value;
        if(t && c) {
            push(mentoriaRef, { titulo: t, conteudo: c, categoria: cat, data: new Date().toLocaleDateString() });
            document.getElementById('in-titulo').value = "";
            document.getElementById('in-conteudo').value = "";
            document.getElementById('add-panel').classList.remove('active');
        }
    };

    function carregar() {
        onValue(mentoriaRef, (snap) => {
            const feed = document.getElementById('feed-operacional');
            feed.innerHTML = "";
            const data = snap.val();
            if(!data) return;

            Object.keys(data).reverse().forEach(id => {
                const item = data[id];
                if(abaAtual !== 'all' && item.categoria !== abaAtual) return;

                feed.innerHTML += `
                    <div class="card-missao">
                        <span class="card-tag">#${item.categoria}</span>
                        <h2 class="card-title">${item.titulo}</h2>
                        <div class="card-body">${item.conteudo}</div>
                        <div class="action-row">
                            <button class="btn-tatico" onclick="injetar('${item.conteudo.replace(/'/g, "\\'")}')">INJETAR NA PEÇA</button>
                            <button class="btn-tatico btn-danger" onclick="apagar('${id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });
        });
    }

    window.injetar = (txt) => { window.parent.receberTexto(txt); };
    window.apagar = (id) => { if(confirm("CONFIRMA EXCLUSÃO DE DADOS?")) remove(ref(db, `mentoria_v13_data/${id}`)); };
    window.filtrar = () => {
        let b = document.getElementById('tatico-search').value.toLowerCase();
        document.querySelectorAll('.card-missao').forEach(c => {
            c.style.display = c.innerText.toLowerCase().includes(b) ? "block" : "none";
        });
    };

    carregar();
</script>
</body>
</html>
