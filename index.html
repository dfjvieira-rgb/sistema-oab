<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA JOAQUIM - OPERACIONAL MASTER</title>
    <style>
        :root { 
            --primary: #002344; --accent: #1e5c2d; --bg: #f4f7f6; 
            --yellow: #f1c40f; --text: #2c3e50; --header-h: 60px; 
            --sidebar-w: 320px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        header { background: var(--primary); color: white; height: var(--header-h); padding: 0 15px; display: flex; justify-content: space-between; align-items: center; z-index: 1000; border-bottom: 3px solid var(--yellow); }
        
        main { display: flex; flex: 1; overflow: hidden; }

        /* SISTEMA DE PASTAS OAB */
        .sidebar-pastas { width: var(--sidebar-w); background: #f8f9fa; border-right: 2px solid #dee2e6; display: flex; flex-direction: column; }
        .folder-header { background: #e9ecef; padding: 15px; border-bottom: 1px solid #ccc; }
        .folder-select { width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #aaa; font-weight: bold; color: var(--primary); outline: none; cursor: pointer; }
        
        .file-list { flex: 1; overflow-y: auto; padding: 10px; }
        .file-item { 
            background: white; padding: 12px; border-radius: 5px; border: 1px solid #ddd; 
            margin-bottom: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px;
            font-size: 0.85rem; font-weight: 500; transition: all 0.2s;
        }
        .file-item:hover { border-color: var(--primary); background: #eef2f7; transform: translateX(5px); }

        /* EDITOR SKELETON */
        .editor-container { flex: 1; display: flex; flex-direction: column; background: white; border-right: 1px solid #ccc; }
        .editor-tools { background: #eee; padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; border-bottom: 1px solid #ddd; }
        
        #area-peca { flex: 1; padding: 30px; border: none; font-family: 'Courier New', monospace; font-size: 16px; line-height: 1.6; outline: none; resize: none; background-attachment: local; background-image: linear-gradient(white 1.55em, #e5e5e5 1.6em); background-size: 100% 1.6em; }

        .pdf-panel { width: 45%; background: #525659; }
        #v-enu { width: 100%; height: 100%; border: none; background: white; }

        .btn-intel { background: var(--primary); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
        .btn-pergaminho { background: var(--yellow) !important; color: black !important; }

        @media (max-width: 1024px) { .pdf-panel { display: none; } }
    </style>
</head>
<body>

<header>
    <div style="display:flex; gap:10px; align-items:center;">
        <button class="btn-intel btn-pergaminho" onclick="abrirEstruturas()">ðŸ“œ PERGAMINHO</button>
        <strong>SISTEMA OPERACIONAL</strong>
    </div>
    <div style="display:flex; gap:8px;">
        <button class="btn-intel" onclick="abrirMod('teses')">TESES</button>
        <button class="btn-intel" onclick="abrirMod('questoes')">50 QUESTÃ•ES</button>
        <button class="btn-intel" onclick="abrirMod('inteligencia')">NÃƒO CONFUNDA</button>
        <button id="btn-save" class="btn-intel" style="background:var(--accent)" onclick="salvarManual()">ðŸ’¾ DISQUETE</button>
    </div>
</header>

<main>
    <aside class="sidebar-pastas">
        <div class="folder-header">
            <select id="folder-selector" class="folder-select" onchange="carregarPasta(this.value)">
                <option value="provas_pmdf">ðŸ“‚ PROVAS PMDF</option>
                <option value="provas_pmgo">ðŸ“‚ PROVAS PMGO</option>
                <option value="leis">ðŸ“‚ VADE MECUM</option>
            </select>
        </div>
        <div class="file-list" id="lista-arquivos"></div>
    </aside>

    <section class="editor-container">
        <div class="editor-tools">
            <span id="doc-titulo">FOLHA DE RESPOSTAS</span>
            <span id="status-save" style="color:red">OFFLINE</span>
        </div>
        <textarea id="area-peca" spellcheck="false" placeholder="Carregando blindagem..."></textarea>
    </section>

    <section class="pdf-panel">
        <iframe id="v-enu" src="about:blank"></iframe>
    </section>
</main>

<script type="module">
    import { db } from './firebase-config.js';
    import { ref, set, get } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const PATH_FIREBASE = "ESTUDO_PM_JOAQUIM/MASTER";

    // CARREGAR PASTA (ESTILO OAB)
    window.carregarPasta = (pasta) => {
        const lista = document.getElementById('lista-arquivos');
        const DATA = {
            provas_pmdf: [
                { nome: "PMDF 2023 - Caderno A", url: "https://www.institutoaocp.org.br/concursos/arquivos/pmdf_soldado_prova_tipo_a.pdf" },
                { nome: "Espelho Discursiva PMDF", url: "https://www.institutoaocp.org.br/concursos/arquivos/pmdf_soldado_espelho_redacao.pdf" }
            ],
            provas_pmgo: [
                { nome: "PMGO 2022 - Soldado", url: "https://www.institutoaocp.org.br/concursos/arquivos/PMGO_SOLDADO_CADERNO_PROVA.pdf" }
            ],
            leis: [
                { nome: "CÃ³digo Penal", url: "https://www.planalto.gov.br/ccivil_03/decreto-lei/del2848compilado.htm", ext: true }
            ]
        };
        lista.innerHTML = '';
        DATA[pasta].forEach(item => {
            const div = document.createElement('div');
            div.className = 'file-item';
            div.innerHTML = `ðŸ“„ ${item.nome}`;
            div.onclick = () => {
                if(item.ext) window.open(item.url, '_blank');
                else document.getElementById('v-enu').src = item.url;
            };
            lista.appendChild(div);
        });
    };

    // FUNÃ‡Ã•ES DE INTELIGÃŠNCIA
    window.abrirEstruturas = () => { document.getElementById('area-peca').value = "--- ESTRUTURA AOCP ---\n1. TEMA\n2. ARGUMENTO TÃ‰CNICO\n3. ARGUMENTO OPERACIONAL\n4. CONCLUSÃƒO"; };
    
    window.abrirMod = (tipo) => {
        const mods = { teses: "[TESES] Legitima Defesa...", questoes: "[BATERIA 50 QUESTÃ•ES]", inteligencia: "[NÃƒO CONFUNDA] Crimes Militares x Comuns" };
        document.getElementById('area-peca').value = mods[tipo];
    };

    // BLINDAGEM NO FIREBASE MASTEROAB-DB5E1
    async function salvarNoFirebase() {
        const txt = document.getElementById('area-peca').value;
        try {
            await set(ref(db, PATH_FIREBASE), { texto: txt, timestamp: Date.now() });
            document.getElementById('status-save').innerText = "BLINDADO NO FIREBASE";
            document.getElementById('status-save').style.color = "green";
        } catch (e) {
            document.getElementById('status-save').innerText = "ERRO AO SALVAR";
        }
    }
    window.salvarManual = salvarNoFirebase;

    // INICIALIZAÃ‡ÃƒO
    window.onload = async () => {
        carregarPasta('provas_pmdf');
        const snap = await get(ref(db, PATH_FIREBASE));
        if(snap.exists()) document.getElementById('area-peca').value = snap.val().texto;
        
        setInterval(salvarNoFirebase, 20000); // Salva a cada 20s
    };
</script>
</body>
</html>
