<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOLHA PMDF - LEGISLAÇÃO VIGENTE 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { --primary: #022c22; --gold: #fbbf24; --bg: #f8fafc; --sidebar: #020617; --green-light: #065f46; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        header { background: var(--primary); padding: 10px 20px; border-bottom: 3px solid var(--gold); display: flex; justify-content: space-between; align-items: center; color: white; z-index: 100; }
        .badge { background: var(--gold); color: black; padding: 4px 8px; border-radius: 4px; font-weight: 900; font-size: 10px; }

        /* LAW-BAR ATUALIZADA 2026 */
        .law-bar { background: #020617; padding: 10px 20px; display: flex; gap: 12px; overflow-x: auto; border-bottom: 1px solid #065f46; }
        .law-link { color: #a7f3d0; text-decoration: none; font-size: 10px; font-weight: 700; display: flex; align-items: center; gap: 6px; white-space: nowrap; transition: 0.3s; padding: 6px 12px; border-radius: 4px; background: rgba(255,255,255,0.05); }
        .law-link:hover { color: var(--gold); background: rgba(255,255,255,0.1); }
        
        main { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 70px; background: var(--sidebar); display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 15px; border-right: 1px solid #065f46; }
        .btn-side { width: 50px; height: 50px; border: none; border-radius: 12px; background: rgba(255,255,255,0.05); color: var(--gold); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .btn-side:hover { background: var(--gold); color: var(--sidebar); }

        .editor-view { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; align-items: center; }
        .paper-official { 
            width: 100%; max-width: 800px; background: white; min-height: 1200px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 50px 60px; position: relative;
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px);
            background-size: 100% 2.2rem; line-height: 2.2rem;
        }
        #editor { outline: none; font-family: 'Courier New', monospace; font-size: 18px; color: #1e293b; text-align: justify; min-height: 1100px; }

        #mentoria-hub { position: fixed; inset: 0; background: #020617; z-index: 9999; display: none; }
        #mentoria-hub.active { display: block; }
        .close-hub { position: absolute; top: 20px; left: 20px; z-index: 10000; padding: 12px 25px; background: var(--gold); border: none; font-weight: 900; cursor: pointer; border-radius: 8px; }

        /* Estilo para Itens na Gaveta */
        .item-gaveta { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .item-gaveta:hover { background: #f1f5f9; }
    </style>
</head>
<body>

<header>
    <div><i class="fas fa-shield-halved"></i> PMDF <span id="status-modo" style="color:var(--gold); margin-left: 10px;">TREINO</span></div>
    <div id="counter" class="badge">LINHAS: 01</div>
</header>

<nav class="law-bar">
    <a href="https://www.planalto.gov.br/ccivil_03/_ato2023-2026/2023/lei/l14751.htm" target="_blank" class="law-link"><i class="fas fa-star"></i> L14.751/23 (ORGÂNICA)</a>
    <a href="https://www.planalto.gov.br/ccivil_03/decreto-lei/del1001compilado.htm" target="_blank" class="law-link"><i class="fas fa-gavel"></i> CPM 2024</a>
    <a href="https://www.planalto.gov.br/ccivil_03/decreto-lei/del1002.htm" target="_blank" class="law-link"><i class="fas fa-handcuffs"></i> CPPM</a>
    <a href="https://sinj.df.gov.br/sinj/Norma/25390/Lei_7289_18_12_1984.html" target="_blank" class="law-link"><i class="fas fa-book"></i> ESTATUTO</a>
    <a href="https://sinj.df.gov.br/sinj/Norma/34211/Decreto_10260_16_02_1987.html" target="_blank" class="law-link"><i class="fas fa-triangle-exclamation"></i> RDPM</a>
</nav>

<main>
    <aside class="sidebar">
        <button class="btn-side" onclick="abrirMentoria()" title="Mentoria IA"><i class="fas fa-robot"></i></button>
        <button class="btn-side" onclick="window.renomearMissao()" title="Renomear Estudo"><i class="fas fa-edit"></i></button>
        <button class="btn-side" onclick="window.finalizarMissao()" title="Salvar na Gaveta"><i class="fas fa-floppy-disk"></i></button>
        <button class="btn-side" onclick="window.gerenciadorGavetas()" title="Abrir Gavetas"><i class="fas fa-box-archive"></i></button>
        <button class="btn-side" onclick="document.execCommand('undo')" title="Desfazer"><i class="fas fa-undo"></i></button>
        <button class="btn-side" onclick="window.print()" title="Imprimir/PDF"><i class="fas fa-print"></i></button>
    </aside>

    <section class="editor-view">
        <div class="paper-official">
            <div id="editor" contenteditable="true" spellcheck="false" oninput="contarLinhas()">
                <b>ESTUDO LEGISLAÇÃO ATUALIZADA - 2026</b><br><br>
                MISSÃO: <span id="display-nome-missao">NOVO RELATÓRIO</span><br>
                ------------------------------------------------------------<br>
            </div>
        </div>
    </section>
</main>

<div id="mentoria-hub">
    <button class="close-hub" onclick="abrirMentoria()">VOLTAR À FOLHA</button>
    <div id="modal-dinamico" style="margin-top: 80px; padding: 20px; color: white;"></div>
    <iframe id="iframe-mentoria" src="mentoria.html" style="width:100%; height:100%; border:none;"></iframe>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, get, set, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ESTADO
    window.modoAtual = localStorage.getItem('pm_modo') || "TREINO";
    window.missaoNome = localStorage.getItem('pm_nome') || "NOVO RELATÓRIO";

    window.onload = async () => {
        window.atualizarInterface();
        await carregarRascunho();
        setInterval(salvarAutomatico, 30000);
    };

    // --- LÓGICA DE GAVETAS ---
    window.gerenciadorGavetas = () => {
        const n = prompt("ACESSO AO ARQUIVO - SELECIONE A GAVETA:\n1. QUESTÕES\n2. TREINO/REDAÇÃO\n3. TESES JURÍDICAS\n4. LEGISLAÇÃO", "1");
        let g = "";
        if(n === "1") g = "QUESTÕES";
        else if(n === "2") g = "TREINO";
        else if(n === "3") g = "TESES";
        else if(n === "4") g = "LEGISLAÇÃO";
        
        if(g) window.abrirListaArquivos(g);
    };

    window.abrirListaArquivos = async (gaveta) => {
        try {
            const snap = await get(ref(db, `producao_v13/HISTORICO_PMDF`));
            if (snap.exists()) {
                const dados = snap.val();
                const filtrados = Object.keys(dados)
                    .map(k => ({ id: k, ...dados[k] }))
                    .filter(item => item.gaveta === gaveta);
                
                if(filtrados.length === 0) return alert("Gaveta vazia, Soldado!");

                let msg = `ARQUIVOS NA GAVETA [${gaveta}]:\n`;
                filtrados.forEach((item, idx) => { msg += `${idx + 1}. ${item.nome}\n`; });
                
                const escolha = prompt(msg + "\nDigite o número para carregar:");
                const alvo = filtrados[parseInt(escolha) - 1];
                if(alvo) {
                    document.getElementById('editor').innerHTML = alvo.conteudo;
                    window.modoAtual = alvo.gaveta;
                    window.missaoNome = alvo.nome.split(' (')[0];
                    window.atualizarInterface();
                    alert("Documento carregado!");
                }
            } else { alert("Nenhum arquivo encontrado."); }
        } catch (e) { alert("Erro ao acessar banco."); }
    };

    // --- SALVAMENTO FINAL ---
    window.finalizarMissao = async () => {
        const ed = document.getElementById('editor');
        const gaveta = prompt("EM QUAL GAVETA DESEJA ARQUIVAR?", window.modoAtual).toUpperCase();
        if(!gaveta) return;

        const id = Date.now().toString();
        const dataStr = new Date().toLocaleString('pt-BR');
        
        try {
            await set(ref(db, `producao_v13/HISTORICO_PMDF/${id}`), {
                gaveta: gaveta,
                nome: `${window.missaoNome} (${dataStr})`,
                conteudo: ed.innerHTML
            });
            window.modoAtual = gaveta;
            window.atualizarInterface();
            alert("✅ MISSÃO ARQUIVADA NA GAVETA: " + gaveta);
        } catch (e) { alert("Erro ao salvar."); }
    };

    window.renomearMissao = () => {
        const n = prompt("NOME DO RELATÓRIO/MISSÃO:", window.missaoNome);
        if(n) { window.missaoNome = n.toUpperCase(); window.atualizarInterface(); }
    };

    window.atualizarInterface = () => {
        localStorage.setItem('pm_modo', window.modoAtual);
        localStorage.setItem('pm_nome', window.missaoNome);
        document.getElementById('status-modo').innerText = window.modoAtual;
        const d = document.getElementById('display-nome-missao');
        if(d) d.innerText = window.missaoNome;
        contarLinhas();
    };

    async function salvarAutomatico() {
        const ed = document.getElementById('editor');
        if(ed) await set(ref(db, `producao_v13/RASCUNHO_PMDF`), { conteudo: ed.innerHTML });
    }

    async function carregarRascunho() {
        const snap = await get(ref(db, `producao_v13/RASCUNHO_PMDF`));
        if(snap.exists()) document.getElementById('editor').innerHTML = snap.val().conteudo;
    }
</script>

<script>
    function abrirMentoria() { 
        const hub = document.getElementById('mentoria-hub');
        hub.classList.toggle('active'); 
    }
    
    function contarLinhas() {
        const ed = document.getElementById('editor');
        const lines = ed.innerText.split('\n').length;
        document.getElementById('counter').innerText = `LINHAS: ${String(lines).padStart(2, '0')}`;
    }

    window.receberTexto = (texto) => {
        const ed = document.getElementById('editor'); ed.focus();
        document.execCommand('insertHTML', false, `<br>${texto}<br>`);
        abrirMentoria();
    };
</script>
</body>
</html>
