<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HUB MENTORIA PM 2026 - BLINDADO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #020617; --gold: #fbbf24; --card: #1e293b;
            --nc: #f472b6; --qp: #a855f7; --tese: #3b82f6; --arsenal: #22c55e;
            --sumula: #f97316; --artigo: #10b981; --pre: #ef4444;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: var(--primary); color: white; margin: 0; padding-bottom: 140px; }

        /* HEADER ESTILO MILITAR */
        header {
            background: #000; padding: 15px 20px; border-bottom: 3px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        .badge-missao { background: var(--gold); color: #000; padding: 2px 8px; border-radius: 4px; font-weight: 900; font-size: 10px; }

        .container { padding: 15px; max-width: 800px; margin: 0 auto; }

        /* CARD DE ALTO IMPACTO (O que mais cai) */
        .post-it {
            padding: 18px; border-radius: 12px; margin-bottom: 15px; color: #020617;
            position: relative; transition: 0.3s; border: 2px solid transparent;
        }
        .post-it.quente { border: 2px solid var(--gold); box-shadow: 0 0 15px var(--gold); }
        
        .post-it strong { display: flex; align-items: center; gap: 10px; font-size: 1.1rem; text-transform: uppercase; }
        .post-it .mnemonico { background: rgba(0,0,0,0.8); color: var(--gold); padding: 5px; border-radius: 4px; font-family: monospace; font-size: 12px; margin-top: 5px; display: inline-block; }

        /* NAVEGA√á√ÉO T√ÅTICA */
        .nav-tabs {
            position: fixed; bottom: 0; left: 0; right: 0; background: #000;
            display: flex; overflow-x: auto; padding: 12px 5px;
            border-top: 2px solid var(--gold); z-index: 2000;
        }
        .tab { 
            color: #64748b; text-align: center; font-size: 9px; min-width: 80px; 
            cursor: pointer; flex-shrink: 0; display: flex; flex-direction: column; align-items: center;
        }
        .tab.active { color: var(--gold); transform: scale(1.1); font-weight: 900; }
        .tab i { font-size: 1.3rem; margin-bottom: 5px; }

        /* INPUTS BLINDADOS */
        .panel-input { background: #0f172a; border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px solid #334155; }
        input, textarea, select { width: 100%; padding: 12px; margin: 5px 0; background: #1e293b; border: 1px solid #475569; color: white; border-radius: 8px; }

        #fab-injetor { position: fixed; bottom: 110px; right: 20px; width: 65px; height: 65px; background: var(--gold); border-radius: 50%; border: none; font-size: 1.8rem; box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 1001; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <div onclick="window.close()"><i class="fas fa-chevron-left"></i> PM 2026</div>
    <div class="badge-missao">MISS√ÉO: APROVA√á√ÉO</div>
</header>

<div class="container">
    <div id="calc-aviso-box" class="panel-input" style="background:white; color:black; display:none;">
        <h3 style="margin:0; color:#020617"><i class="fas fa-stopwatch"></i> PRAZOS E AVISO</h3>
        <p style="font-size:11px">Calcular Proporcionalidade (Lei 12.506):</p>
        <input type="number" id="anos-trabalho" style="background:#eee; color:#000" placeholder="Anos Completos" oninput="window.calcularPMPrazo()">
        <div id="total-dias" style="font-size:2rem; font-weight:900; text-align:center">30 DIAS</div>
        <button onclick="window.injetarNaPeca('AVISO')" style="width:100%; background:black; color:white; padding:10px; border-radius:8px">INJETAR FUNDAMENTA√á√ÉO</button>
    </div>

    <div class="panel-input">
        <h4 style="margin:0; color:var(--gold)">NOVO CONTE√öDO T√ÅTICO</h4>
        <input id="inp-t" placeholder="T√≠tulo (Ex: Art. 5¬∫, LXI CF)">
        <textarea id="inp-c" rows="2" placeholder="Tese ou Artigo (O que escrever na prova)"></textarea>
        <input id="inp-g" placeholder="Mnem√¥nico ou Gatilho (Ex: SO-CI-DI-VA-PLU)">
        <div style="display:flex; gap:10px">
             <select id="sel-cat" style="flex:1">
                <option value="qp">Qual a Pe√ßa?</option>
                <option value="nc">N√£o Confunda</option>
                <option value="tese" selected>Tese de M√©rito</option>
                <option value="pre">Preliminar</option>
                <option value="arsenal">50 Quest√µes</option>
             </select>
             <button id="btn-salvar" style="background:var(--gold); border:none; padding:10px 20px; border-radius:8px; font-weight:900">SALVAR</button>
        </div>
    </div>

    <div id="feed-v13"></div>
</div>

<nav class="nav-tabs">
    <div class="tab active" onclick="window.showTab('qp')"><i class="fas fa-crosshairs"></i>PE√áA</div>
    <div class="tab" onclick="window.showTab('nc')"><i class="fas fa-bolt"></i>N.C</div>
    <div class="tab" onclick="window.showTab('pre')"><i class="fas fa-shield-alt"></i>PRELIMINAR</div>
    <div class="tab" onclick="window.showTab('tese')"><i class="fas fa-gavel"></i>TESES</div>
    <div class="tab" onclick="window.showTab('aviso')"><i class="fas fa-calendar-alt"></i>PRAZOS</div>
    <div class="tab" onclick="window.showTab('arsenal')"><i class="fas fa-list-ol"></i>50Q</div>
</nav>

<button id="fab-injetor" onclick="window.cargaAutomaticaPM()"><i class="fas fa-rocket"></i></button>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue, push, remove, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const config = {
        apiKey: "AIzaSyAmigODFK8R9c0-fWtagdxLWu9xkODfKYQ",
        authDomain: "masteroab-db5e1.firebaseapp.com",
        projectId: "masteroab-db5e1",
        databaseURL: "https://masteroab-db5e1-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(config);
    const db = getDatabase(app);
    const DB_PATH = "PM2026_TACTICAL_V1";

    let currentTab = 'qp';
    let cache = {};

    // --- L√ìGICA DE INTERFACE ---
    window.showTab = (tab) => {
        currentTab = tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        const activeTab = document.querySelector(`.tab[onclick*='${tab}']`);
        if(activeTab) activeTab.classList.add('active');
        
        document.getElementById('calc-aviso-box').style.display = (tab === 'aviso') ? 'block' : 'none';
        render();
    };

    window.calcularPMPrazo = () => {
        const anos = parseInt(document.getElementById('anos-trabalho').value) || 0;
        const total = 30 + (Math.min(anos, 20) * 3);
        document.getElementById('total-dias').innerText = total + " DIAS";
    };

    // --- CRUD ---
    document.getElementById('btn-salvar').onclick = () => {
        const t = document.getElementById('inp-t').value;
        const c = document.getElementById('inp-c').value;
        const g = document.getElementById('inp-g').value;
        const cat = document.getElementById('sel-cat').value;
        
        if(!t || !c) return alert("Preencha o essencial para a miss√£o!");
        
        push(ref(db, DB_PATH), { t, c, g, cat, ts: serverTimestamp() });
        
        ["inp-t", "inp-c", "inp-g"].forEach(id => document.getElementById(id).value = "");
    };

    onValue(ref(db, DB_PATH), (snap) => {
        cache = snap.val() || {};
        render();
    });

    function render() {
        const f = document.getElementById('feed-v13');
        f.innerHTML = "";
        const cores = { qp:'#a855f7', nc:'#f472b6', pre:'#ef4444', tese:'#3b82f6', arsenal:'#22c55e', aviso:'#ffffff' };
        
        Object.keys(cache).reverse().forEach(id => {
            const it = cache[id];
            if(it.cat === currentTab) {
                const isQuente = it.t.toLowerCase().includes("cf") || it.t.toLowerCase().includes("sumula");
                f.innerHTML += `
                    <div class="post-it ${isQuente ? 'quente' : ''}" style="background:${cores[it.cat]}">
                        <strong>${it.t}</strong>
                        <p style="margin:8px 0; font-size:14px">${it.c}</p>
                        ${it.g ? `<div class="mnemonico">üß† GATILHO: ${it.g}</div>` : ""}
                        <div style="display:flex; gap:10px; margin-top:10px">
                            <button onclick="window.injetarNaPeca('${id}')" style="background:#000; color:#fff; border:none; padding:5px 10px; border-radius:4px; font-size:10px">INJETAR F.F.P</button>
                            <button onclick="window.apagar('${id}')" style="background:rgba(0,0,0,0.1); border:none; margin-left:auto"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
            }
        });
    }

    // --- FUN√á√ïES DE IMPACTO ---
    window.injetarNaPeca = (id) => {
        let texto = "";
        if(id === 'AVISO') {
            const dias = document.getElementById('total-dias').innerText;
            texto = `TESE: DO AVISO PR√âVIO\nO reclamante laborou por mais de um ano, fazendo jus ao aviso pr√©vio proporcional de ${dias}, conforme Art. 1¬∫, par√°grafo √∫nico da Lei 12.506/11. Requer-se o pagamento.`;
        } else {
            const it = cache[id];
            texto = `TESE: ${it.t.toUpperCase()}\nFATO: ...\nFUNDAMENTO: ${it.c}. Nos termos do artigo ...\nPEDIDO: Diante do exposto, requer a condena√ß√£o da reclamada ao pagamento de ...`;
        }
        
        window.opener.postMessage({ type: 'INJETAR_PM', texto: texto }, '*');
        alert("Enviado para o Plano de Voo!");
    };

    window.apagar = (id) => { if(confirm("Eliminar este registro?")) remove(ref(db, `${DB_PATH}/${id}`)); };

    window.cargaAutomaticaPM = () => {
        const base = [
            { t: "Art. 144 CF/88", c: "A seguran√ßa p√∫blica √© dever do Estado, direito e responsabilidade de todos.", g: "SEG-PUB-EST", cat: "qp" },
            { t: "S√∫mula 369 TST", c: "O dirigente sindical goza de estabilidade desde o registro da candidatura at√© um ano ap√≥s o mandato.", g: "SIND-ESTAB", cat: "tese" },
            { t: "Incompet√™ncia Absoluta", c: "A Justi√ßa do Trabalho √© incompetente para processar e julgar causas de regime estatut√°rio.", g: "ADPF 339", cat: "pre" }
        ];
        base.forEach(b => push(ref(db, DB_PATH), { ...b, ts: serverTimestamp() }));
        window.showTab('tese');
    };

    window.onload = () => window.showTab('qp');
</script>
</body>
</html>
